{% load staticfiles %}
{% load votainteligente_extras %}
{% load i18n %}
{% load thumbnail %}
<script type="text/javascript">
    $(function(){
        $('.loadFromUrl').on('show.bs.modal', function (event) {
          var anchor = $(event.relatedTarget) // Button that triggered the modal
          var modal = $(this)
          var body = modal.find('.modal-body');
          body.load(anchor.data('url'));
        })
        $('[data-toggle="tooltip"]').tooltip();
    });

var unlike_proposal = function(url){
    $.post(url, function(data){
        location.reload();
    })
};
$(function(){
    $('.unlike_proposal').click(function(event){
        event.preventDefault();
        var target = $(event.target);
        var url = target.parent().attr('href');
        unlike_proposal(url);
    })
});
</script>
<div class="row">
    <div class="col-md-3 col-sm-3 col-xs-3">
        {% if user.is_authenticated %}

            {% if not user|likes:proposal %}
            
            <a class="btn-apoyo" data-toggle="modal" data-target="#supportProposal" 
                data-url="{% url 'popular_proposals:like_a_proposal' pk=proposal.id %}{%if next_url%}?next={{next_url}}{% endif %}">
                {% blocktrans %}
                  <span class="fa-stack fa-2x">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-heart fa-stack-1x fa-inverse"></i>
                  </span>
                {% endblocktrans %}
            </a>
            {% include 'modal.html' with modalId='supportProposal' title='Apoya una propuesta' %}
            {% else %}
            {% with  user|support:proposal as support %}
                <a class="unlike_proposal" href="{% url 'popular_proposals:unlike_proposal' pk=support.id %}"><img src="{% static 'img/adherido.svg' %}"></a>
            {% endwith %}
            {% endif %}
        {% else %}
            <a class="btn btn-md btn-success full-width"  href="{% url 'auth_login' %}">
                {% blocktrans %}<i class="fa fa-heart" aria-hidden="true"></i>{% endblocktrans %}
            </a>

        {% endif%}
    </div>
    <div class="col-md-9 col-sm-9 col-xs-9">
        {% blocktrans with count=proposal.likers.count %}
            <p class="nota">{{count}} ciudadanos apoyan esta propuesta</p>
        {% endblocktrans %}
    </div>
</div>
