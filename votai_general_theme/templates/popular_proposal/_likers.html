{% load staticfiles %}
{% load votainteligente_extras %}
{% load i18n %}
{% load thumbnail %}
<script type="text/javascript">
    $(function(){
        $('.loadFromUrl').on('show.bs.modal', function (event) {
          var anchor = $(event.relatedTarget) // Button that triggered the modal
          var modal = $(this)
          var body = modal.find('.modal-body');
          body.load(anchor.data('url'));
        })
        $('[data-toggle="tooltip"]').tooltip();
    });

var unlike_proposal = function(url){
    $.post(url, function(data){
        location.reload();
    })
};
$(function(){
    $('.unlike_proposal').click(function(event){
        event.preventDefault();
        var target = $(event.target);
        var url = target.parent().attr('href');
        unlike_proposal(url);
    })
});
</script>
<div class="apoyo">
    <div class="apoyo-btn pull-left">
        {% if not is_embedded %}
            {% if user.is_authenticated %}
                {% if user|is_candidate %}
                    <a class="btn-apoyo" href="{{proposal.get_absolute_url}}">
                        {% blocktrans %}
                          <span class="fa-stack fa-2x">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-heart fa-stack-1x fa-inverse"></i>
                          </span>
                        {% endblocktrans %}
                    </a>
                {% else %}
                    {% if not user|likes:proposal %}
                
                        <a class="btn-apoyo" data-toggle="modal" data-target="#supportProposal" data-url="{% url 'popular_proposals:like_a_proposal' pk=proposal.id %}{%if next_url%}?next={{next_url}}{% endif %}">
                            {% blocktrans %}
                              <span class="fa-stack fa-2x">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-heart fa-stack-1x fa-inverse"></i>
                              </span>
                            {% endblocktrans %}
                        </a>
                        {% include 'modal.html' with modalId='supportProposal' title='Apoya una propuesta' %}
                        {% else %}
                        {% with  user|support:proposal as support %}
                            <a class="unlike_proposal" href="{% url 'popular_proposals:unlike_proposal' pk=support.id %}" data-toggle="tooltip" data-placement="top" title="Ya no quiero apoyar esta propuesta"><img src="{% static 'img/adherido.svg' %}"></a>
                        {% endwith %}
                        {% endif %}
                {% endif %}
                
            {% else %}
                <a class="btn btn-md btn-success full-width"  href="{% url 'auth_login' %}">
                    {% blocktrans %}<i class="fa fa-heart" aria-hidden="true"></i>{% endblocktrans %}
                </a>

            {% endif %}
        {% else %}
        <a class="btn-apoyo" href="{{proposal.get_absolute_url}}">
            {% blocktrans %}
              <span class="fa-stack fa-2x">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-heart fa-stack-1x fa-inverse"></i>
              </span>
            {% endblocktrans %}
        </a>
        {% endif %}
    </div>
    <div class="apoyo-contador">
        {% blocktrans with count=proposal.likers.count %}
            <p class="nota">{{count}} ciudadanos apoyan esta propuesta</p>
        {% endblocktrans %}
    </div>
</div>
