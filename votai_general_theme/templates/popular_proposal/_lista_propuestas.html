{% load staticfiles %}
{% load i18n %}
{% load thumbnail %}
{% load bootstrap3 %}
{% load votainteligente_extras %}
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery.form/4.2.1/jquery.form.min.js" />
<script>
$(function(){
    $('.loadFromUrl').on('show.bs.modal', function (event) {
      var anchor = $(event.relatedTarget) // Button that triggered the modal
      var modal = $(this)
      var body = modal.find('.modal-body');
      body.load(anchor.data('url'));
    })
    $('[data-toggle="tooltip"]').tooltip();
});
</script>

    {% if form %}
    {% include 'modal.html' with modalId='subscribeToSearch' title='Mantente al dia con tus tematicas de interes' %}
    <a id="top"></a>
    {% if form.is_filled_search %}
    <button class="hidden-md hidden-lg btn btn-link btn-block" type="button" data-toggle="collapse" data-target=".filter-mobile" aria-expanded="false" aria-controls="filter-mobile"><i class="fa fa-filter"></i> Mostrar filtros</button>
    {% endif %}
		<form id="proposalFilterForm" action="{{ request.path }}" method="GET" role="form" class="hidden-md hidden-lg filter-mobile {% if form.is_filled_search %}collapse{% endif %}">
      <div class="row">
        <div class="col-md-3">{% bootstrap_field form.text %}</div>
        <div class="col-md-3">{% bootstrap_field form.clasification %}</div>
        <div class="col-md-3">{% bootstrap_field form.generated_at %}</div>
        <div class="col-md-3">{% bootstrap_field form.order_by %}</div>
      </div>
      <div class="row">
        <!-- mobile version -->
        <div class="col-md-12 text-right visible-xs-*">
          <button type="submit" class="btn btn-success btn-block">{% trans 'Filtrar'%}</button>
          {% if form.is_filled_search %}
            <a href="{% url 'popular_proposals:home' %}" class="btn btn-primary btn-block">{% trans 'Limpiar Filtro'%}</a>
          {% endif %}
          {% if user.is_authenticated and form.is_filled_search and config.SEARCH_SUBSCRIPTION_ENABLED %}
            <a id="subscribeToSearchButton" class="btn btn-info btn-block" data-toggle="modal" data-url="{% url 'proposal_subscriptions:subscribe' %}" data-target="#subscribeToSearch"><i class="fa fa-bell-o"></i> {% trans 'Subscribete a este resultado' %}</a>
          {% endif %}
        </div>
        <!-- end mobile version -->
      </div>
		</form>

    <form id="proposalFilterForm" action="{{ request.path }}" method="GET" role="form" class="hidden-xs hidden-sm">
      <div class="row">
        <div class="col-md-3">{% bootstrap_field form.text %}</div>
        <div class="col-md-3">{% bootstrap_field form.clasification %}</div>
        <div class="col-md-3">{% bootstrap_field form.generated_at %}</div>
        <div class="col-md-3">{% bootstrap_field form.order_by %}</div>
      </div>
      <div class="row">
        <div class="col-md-12 text-right visible-md-*">
          <button type="submit" class="btn btn-success">{% trans 'Filtrar'%}</button>
          {% if form.is_filled_search %}
            <a href="{% url 'popular_proposals:home' %}" class="btn btn-primary">{% trans 'Limpiar Filtro'%}</a>
          {% endif %}
        </div>
      </div>
    </form>
    {% endif %}
    <script>
    $(function(){
      $('#proposalFilterForm').submit(function() {
        $(':input', this).each(function() {
          this.disabled = !($(this).val());
        });
      });

      window.onscroll = function (e) {
        if( document.body.scrollTop >= 600 ) {
          $('#raiseToTop i').css('display','block');
        }
        if( document.body.scrollTop < 600 ) {
          $('#raiseToTop i').css('display','none');
        }
      }
    });

    </script>

<div id="grid">
      {% if form.is_filled_search %}
      <p>Hay {{popular_proposals|length}} propuestas ciudadanas con tus criterios de búsqueda seleccionados</p>
      {% else %}
      <p>Hay {{popular_proposals|length}} propuestas ciudadanas</p>
      {% endif %}
      {% if user.is_authenticated and form.is_filled_search and config.SEARCH_SUBSCRIPTION_ENABLED %}
      <div class="row hidden-xs">
        <div class="col-md-6 col-md-offset-3">
          <div class="alert alert-info text-center" role='alert'>
            <button type="button" class="close" data-dismiss='alert' aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            <a id="subscribeToSearchButton" data-toggle="modal" data-url="{% url 'proposal_subscriptions:subscribe' %}" data-target="#subscribeToSearch"><i class="fa fa-bell-o"></i> {% trans 'Recibe notificaciones en tu correo con el resultado de esta búsqueda' %}</a>
          </div>
        </div>
      </div>
      {% endif %}
    <div id="posts">
      {% for proposal in popular_proposals %}
          {% include 'popular_proposal/popular_proposal_card.html' with proposal=proposal is_embedded=is_embedded %}
      {% empty %}
      {% url 'popular_proposals:propose_wizard_full_without_area' as create_proposal_url %}
    </div>
    {% blocktrans %}
    <p class="bg-info">
      Aún no se han generado propuestas para esta búsqueda.
      Se tu la/el primera/o en generar la primera propuesta en el siguiente <a href="{{create_proposal_url}}">enlace</a>.
    </p>
    {% endblocktrans %}
    {% endfor %}

</div>
<div class="container" id="raiseToTop">
  <div class="row">
    <div class="col-xs-12 col-md-12">
      <a href="#top" title="ir arriba"><i class="fa fa-arrow-up fa-2x pull-right" style="display:none"></i></a>
    </div>
  </div>
</div>